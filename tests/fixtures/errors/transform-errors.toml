# Error handling tests: Transform errors
# Based on Vue.js core compiler-core/__tests__/transforms errors

# =============================================================================
# v-if transform errors
# =============================================================================

[[cases]]
name = "v-if no expression"
input = '<div v-if></div>'
[cases.expected]
error = "X_V_IF_NO_EXPRESSION"
error_message_contains = ["v-if", "expression"]

[[cases]]
name = "v-else without v-if"
input = '<div v-else></div>'
[cases.expected]
error = "X_V_ELSE_NO_ADJACENT_IF"

[[cases]]
name = "v-else-if without v-if"
input = '<div v-else-if="b"></div>'
[cases.expected]
error = "X_V_ELSE_NO_ADJACENT_IF"

[[cases]]
name = "v-else after v-else"
input = '<div v-if="a"></div><div v-else></div><div v-else></div>'
[cases.expected]
error = "X_V_ELSE_NO_ADJACENT_IF"

[[cases]]
name = "v-else-if after v-else"
input = '<div v-if="a"></div><div v-else></div><div v-else-if="b"></div>'
[cases.expected]
error = "X_V_ELSE_NO_ADJACENT_IF"

[[cases]]
name = "v-if with key on different branches"
input = '<div v-if="a" :key="a + 1"></div><div v-else :key="a + 1"></div>'
[cases.expected]
error = "X_V_IF_SAME_KEY"
error_message_contains = ["key"]

# =============================================================================
# v-for transform errors
# =============================================================================

[[cases]]
name = "v-for no expression"
input = '<div v-for></div>'
[cases.expected]
error = "X_V_FOR_NO_EXPRESSION"
error_message_contains = ["v-for"]

[[cases]]
name = "v-for missing in/of"
input = '<div v-for="item items"></div>'
[cases.expected]
error = "X_V_FOR_MALFORMED_EXPRESSION"
error_message_contains = ["in", "of"]

[[cases]]
name = "v-for missing alias"
input = '<div v-for="in items"></div>'
[cases.expected]
error = "X_V_FOR_MALFORMED_EXPRESSION"

[[cases]]
name = "v-for missing iterator"
input = '<div v-for="item in"></div>'
[cases.expected]
error = "X_V_FOR_MALFORMED_EXPRESSION"

[[cases]]
name = "v-for template key on child"
input = '<template v-for="item in items"><div :key="item.id"></div></template>'
[cases.expected]
error = "X_V_FOR_TEMPLATE_KEY_PLACEMENT"
error_message_contains = ["key", "template"]

# =============================================================================
# v-bind transform errors
# =============================================================================

[[cases]]
name = "v-bind with empty expression"
input = '<div v-bind:id=""></div>'
[cases.expected]
error = "X_V_BIND_NO_EXPRESSION"

[[cases]]
name = "v-bind shorthand with dynamic arg and no expression"
input = '<div :[dynamicKey]></div>'
[cases.expected]
error = "X_V_BIND_INVALID_SAME_NAME_ARGUMENT"
error_message_contains = ["dynamic"]

# =============================================================================
# v-on transform errors
# =============================================================================

[[cases]]
name = "v-on with empty expression"
input = '<div v-on:click=""></div>'
[cases.expected]
error = "X_V_ON_NO_EXPRESSION"

[[cases]]
name = "v-on without argument or expression"
input = '<div v-on></div>'
[cases.expected]
error = "X_V_ON_NO_EXPRESSION"

# =============================================================================
# v-model transform errors
# =============================================================================

[[cases]]
name = "v-model no expression"
input = '<input v-model />'
[cases.expected]
error = "X_V_MODEL_NO_EXPRESSION"

[[cases]]
name = "v-model empty expression"
input = '<input v-model="" />'
[cases.expected]
error = "X_V_MODEL_NO_EXPRESSION"

[[cases]]
name = "v-model invalid expression (function call)"
input = '<input v-model="foo()" />'
[cases.expected]
error = "X_V_MODEL_MALFORMED_EXPRESSION"
error_message_contains = ["valid"]

[[cases]]
name = "v-model invalid expression (binary)"
input = '<input v-model="a + b" />'
[cases.expected]
error = "X_V_MODEL_MALFORMED_EXPRESSION"

[[cases]]
name = "v-model invalid expression (unary)"
input = '<input v-model="!a" />'
[cases.expected]
error = "X_V_MODEL_MALFORMED_EXPRESSION"

[[cases]]
name = "v-model on v-for scope variable"
input = '<div v-for="item in items"><input v-model="item" /></div>'
[cases.expected]
error = "X_V_MODEL_ON_SCOPE_VARIABLE"
error_message_contains = ["v-for"]

[[cases]]
name = "v-model argument on native element"
input = '<input v-model:value="text" />'
[cases.expected]
error = "X_V_MODEL_ARG_ON_ELEMENT"
error_message_contains = ["argument"]

[[cases]]
name = "v-model with .sync modifier"
input = '<input v-model.sync="text" />'
[cases.expected]
error = "X_V_MODEL_ON_FILE_INPUT_ELEMENT"

[[cases]]
name = "v-model on file input"
input = '<input type="file" v-model="file" />'
[cases.expected]
error = "X_V_MODEL_ON_FILE_INPUT_ELEMENT"
error_message_contains = ["file"]

# =============================================================================
# v-show transform errors
# =============================================================================

[[cases]]
name = "v-show no expression"
input = '<div v-show></div>'
[cases.expected]
error = "X_V_SHOW_NO_EXPRESSION"

[[cases]]
name = "v-show empty expression"
input = '<div v-show=""></div>'
[cases.expected]
error = "X_V_SHOW_NO_EXPRESSION"

[[cases]]
name = "v-show on template"
input = '<template v-show="a"><div></div></template>'
[cases.expected]
error = "X_V_SHOW_ON_TEMPLATE"
error_message_contains = ["template"]

# =============================================================================
# v-slot transform errors
# =============================================================================

[[cases]]
name = "v-slot misplaced on element"
input = '<div v-slot:header></div>'
[cases.expected]
error = "X_V_SLOT_MISPLACED"
error_message_contains = ["<template>", "component"]

[[cases]]
name = "v-slot default and named slots mixed"
input = '<Comp v-slot>text<template #header></template></Comp>'
[cases.expected]
error = "X_V_SLOT_EXTRANEOUS_DEFAULT_SLOT_CHILDREN"

[[cases]]
name = "v-slot duplicate slot names"
input = '<Comp><template #foo></template><template #foo></template></Comp>'
[cases.expected]
error = "X_V_SLOT_DUPLICATE_SLOT_NAMES"
error_message_contains = ["foo"]

[[cases]]
name = "v-slot on native element"
input = '<div #header></div>'
[cases.expected]
error = "X_V_SLOT_MISPLACED"

[[cases]]
name = "v-slot named default in shorthand"
input = '<Comp v-slot:default="{ item }"><template #default></template></Comp>'
[cases.expected]
error = "X_V_SLOT_MIXED_SLOT_USAGE"

# =============================================================================
# v-once and v-memo transform errors
# =============================================================================

[[cases]]
name = "v-memo without array"
input = '<div v-memo="foo"></div>'
[cases.expected]
error = "X_V_MEMO_INVALID_EXPRESSION"
error_message_contains = ["array"]

[[cases]]
name = "v-memo on v-for without key"
input = '<div v-for="item in items" v-memo="[item]"></div>'
[cases.expected]
error = "X_V_MEMO_ON_V_FOR_WITHOUT_KEY"

# =============================================================================
# Built-in component errors
# =============================================================================

[[cases]]
name = "Teleport without to"
input = '<Teleport><div></div></Teleport>'
[cases.expected]
error = "X_TELEPORT_MISSING_TO"
error_message_contains = ["to"]

[[cases]]
name = "KeepAlive with multiple children"
input = '<KeepAlive><div></div><span></span></KeepAlive>'
[cases.expected]
error = "X_KEEP_ALIVE_INVALID_CHILDREN"
error_message_contains = ["single"]

[[cases]]
name = "Transition with multiple children"
input = '<Transition><div></div><span></span></Transition>'
[cases.expected]
error = "X_TRANSITION_INVALID_CHILDREN"
error_message_contains = ["single"]

# =============================================================================
# Scope errors
# =============================================================================

[[cases]]
name = "reference to undefined variable"
input = '<div>{{ undefinedVar }}</div>'
[cases.expected]
error = "X_UNDEFINED_IDENTIFIER"

[[cases]]
name = "reference to private property"
input = '<div>{{ _privateVar }}</div>'
[cases.expected]
error = "X_PRIVATE_IDENTIFIER"
error_message_contains = ["_"]

[[cases]]
name = "reference to $data directly"
input = '<div>{{ $data }}</div>'
[cases.expected]
error = "X_RESTRICTED_GLOBAL"
error_message_contains = ["$data"]

# =============================================================================
# Expression errors
# =============================================================================

[[cases]]
name = "invalid JavaScript expression"
input = '<div :id="{ invalid syntax }"></div>'
[cases.expected]
error = "X_INVALID_EXPRESSION"

[[cases]]
name = "unexpected token in expression"
input = '<div :id="const x = 1"></div>'
[cases.expected]
error = "X_INVALID_EXPRESSION"
error_message_contains = ["const"]

[[cases]]
name = "assignment in expression"
input = '<div :id="x = 1"></div>'
[cases.expected]
error = "X_INVALID_EXPRESSION"

[[cases]]
name = "increment in v-bind"
input = '<div :id="x++"></div>'
[cases.expected]
error = "X_INVALID_EXPRESSION"
